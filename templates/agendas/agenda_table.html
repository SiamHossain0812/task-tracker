{% if agendas %}
<div class="card bg-white rounded-3xl border border-gray-100 shadow-xl overflow-hidden animate-slide-up delay-300">
    <!-- Table Header -->
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50/50 border-b border-gray-100">
                <tr>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">SN</th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider pl-10">Task
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Date & Time
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Deadline
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-4 text-center text-xs font-bold text-gray-400 uppercase tracking-wider">Actions
                    </th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-50">
                {% for agenda in agendas %}
                <tr class="hover:bg-gray-50/80 transition-colors group">
                    <!-- SN -->
                    <td class="px-6 py-4 text-sm font-bold text-gray-400">{{ forloop.counter }}</td>

                    <!-- Agenda Title -->
                    <td class="px-6 py-4 text-sm">
                        <div class="flex items-start gap-4">
                            <div class="w-2 h-2 rounded-full mt-2 flex-shrink-0 
                                {% if agenda.priority == 'high' %}bg-red-500 shadow-sm shadow-red-200
                                {% elif agenda.priority == 'medium' %}bg-amber-500 shadow-sm shadow-amber-200
                                {% else %}bg-emerald-500 shadow-sm shadow-emerald-200{% endif %}">
                            </div>

                            <div>
                                <div class="flex items-center gap-2">
                                    <span
                                        class="font-bold text-gray-800 text-base {% if agenda.status == 'completed' %}line-through text-gray-400{% endif %}">
                                        {{ agenda.title|default:'(no title)' }}
                                    </span>
                                </div>
                                {% if agenda.project %}
                                <div class="flex items-center gap-1.5 mt-1">
                                    <span class="w-1.5 h-1.5 rounded-full bg-{{ agenda.project.color }}-500"></span>
                                    <span class="text-xs font-semibold text-gray-500">{{ agenda.project.name }}</span>
                                </div>
                                {% endif %}

                                <!-- Resources & Collab -->
                                <div class="flex items-center gap-2 mt-2 flex-wrap">
                                    {% if agenda.external_link %}
                                    <a href="{{ agenda.external_link }}" target="_blank"
                                        class="inline-flex items-center gap-1 text-[10px] font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-lg border border-indigo-100 hover:bg-indigo-100 transition-colors"
                                        title="External Link">
                                        <i class="fas fa-link"></i> Link
                                    </a>
                                    {% endif %}
                                    {% if agenda.attachment %}
                                    <a href="{{ agenda.attachment.url }}" target="_blank"
                                        class="inline-flex items-center gap-1 text-[10px] font-bold text-gray-600 bg-gray-100 px-2 py-0.5 rounded-lg border border-gray-200 hover:bg-gray-200 transition-colors"
                                        title="Attachment">
                                        <i class="fas fa-paperclip"></i> File
                                    </a>
                                    {% endif %}

                                    {% if agenda.collaborators.all %}
                                    <div
                                        class="flex items-center -space-x-2 hover:space-x-1 transition-all duration-200 ml-1">
                                        {% for collaborator in agenda.collaborators.all %}
                                        <div class="relative group/collab">
                                            {% if collaborator.image %}
                                            <img src="{{ collaborator.image.url }}" alt="{{ collaborator.name }}"
                                                class="w-6 h-6 rounded-full object-cover border-2 border-white shadow-sm ring-1 ring-gray-100 hover:scale-110 transition-transform"
                                                title="{{ collaborator.name }} ({{ collaborator.institute }})">
                                            {% else %}
                                            <div class="w-6 h-6 rounded-full bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center border-2 border-white shadow-sm ring-1 ring-gray-100 hover:scale-110 transition-transform"
                                                title="{{ collaborator.name }} ({{ collaborator.institute }})">
                                                <span class="text-[10px] font-bold text-emerald-700">{{
                                                    collaborator.name|slice:":1" }}</span>
                                            </div>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>

                    <!-- Date & Time -->
                    <td class="px-6 py-4 text-sm">
                        <div class="flex flex-col">
                            <span
                                class="font-bold text-gray-700 text-sm {% if agenda.date < today and agenda.status != 'completed' %}text-red-500{% endif %}">
                                {{ agenda.date|date:"M d, Y" }}
                            </span>
                            {% if agenda.time %}
                            <span class="text-xs font-semibold text-gray-400">
                                {{ agenda.time|time:"g:i A" }}
                            </span>
                            {% endif %}
                        </div>
                    </td>

                    <!-- Expected Completion Date -->
                    <td class="px-6 py-4 text-sm">
                        {% if agenda.expected_finish_date %}
                        <div class="flex flex-col">
                            <span class="font-semibold text-gray-600 text-sm">
                                {{ agenda.expected_finish_date|date:"M d, Y" }}
                            </span>
                            {% if agenda.expected_finish_time %}
                            <span class="text-xs font-semibold text-gray-400">{{ agenda.expected_finish_time|time:"g:i
                                A" }}</span>
                            {% endif %}
                        </div>
                        {% else %}
                        <span class="text-gray-300 text-xs font-bold tracking-wider">â€”</span>
                        {% endif %}
                    </td>

                    <!-- Status -->
                    <td class="px-6 py-4 text-sm">
                        <form action="{% url 'agenda_toggle' agenda.pk %}" method="POST" class="toggle-form">
                            {% csrf_token %}
                            <button type="submit" class="px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-all 
                                    {% if agenda.status == 'completed' %}bg-emerald-100 text-emerald-700 hover:bg-emerald-200 shadow-sm shadow-emerald-100
                                    {% elif agenda.status == 'in-progress' %}bg-blue-100 text-blue-700 hover:bg-blue-200 shadow-sm shadow-blue-100
                                    {% else %}bg-gray-100 text-gray-600 hover:bg-gray-200{% endif %}">
                                {{ agenda.get_status_display }}
                            </button>
                        </form>
                    </td>

                    <!-- Actions -->
                    <td class="px-6 py-4 text-center">
                        <div
                            class="flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 transition-all duration-200 translate-y-1 group-hover:translate-y-0">
                            <!-- Edit Button -->
                            <a href="{% url 'agenda_edit' agenda.pk %}"
                                class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-400 hover:text-emerald-600 hover:border-emerald-200 hover:bg-emerald-50 shadow-sm flex items-center justify-center transition-all"
                                title="Edit">
                                <i class="fas fa-pen text-xs"></i>
                            </a>

                            <!-- Delete Button -->
                            <a href="{% url 'agenda_delete' agenda.pk %}"
                                class="w-8 h-8 rounded-lg bg-white border border-gray-200 text-gray-400 hover:text-red-600 hover:border-red-200 hover:bg-red-50 shadow-sm flex items-center justify-center transition-all"
                                title="Delete">
                                <i class="fas fa-trash text-xs"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div
    class="card w-full bg-white rounded-3xl border border-gray-100 shadow-xl overflow-hidden animate-slide-up delay-300">
    <div class="flex flex-col items-center justify-center py-20 text-center animate-fade-in p-8">
        <div
            class="w-24 h-24 bg-gradient-to-br from-emerald-50 to-teal-50 text-emerald-300 rounded-full flex items-center justify-center mb-6 shadow-sm border border-emerald-100/50">
            <i class="fas fa-clipboard-check text-4xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">No tasks yet</h3>
        <p class="text-gray-500 font-medium mb-8 max-w-xs mx-auto leading-relaxed">You're all caught up! Add a new task
            to get started on your next goal.</p>
        <a href="{% url 'agenda_create_global' %}"
            class="px-8 py-3.5 bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-700 hover:to-emerald-600 text-white font-bold rounded-xl transition-all shadow-lg shadow-emerald-200 hover:shadow-emerald-300 hover:-translate-y-0.5 flex items-center gap-2">
            <i class="fas fa-plus"></i> Add First Task
        </a>
    </div>
</div>
{% endif %}